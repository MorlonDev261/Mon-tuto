<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D√©veloppement web pour t√©l√©phone mobile</title>
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.28.0/themes/prism-tomorrow.css" rel="stylesheet">
  <link href="styles.css" rel="stylesheet">
</head>
<body>
  <header>
    <h1 id="page-title">Tutoriel React, Redux & Vite</h1>
    <p>Guide d'installation et d'utilisation</p>
  </header>
  <div class="container">
    <div class="skeleton-container">
      <div class="skeleton-app">
        <div class="sk-title"></div>
        <div class="sk-list-app">
          <div class="sk-app"></div>
          <div class="sk-app"></div>
          <div class="sk-app"></div>
        </div>
      </div>
      <div class="skeleton">
        <div class="skeleton-title"></div>
        <div class="skeleton-text"></div>
        <div class="skeleton-text skeleton-text-2"></div>
        <div class="skeleton-code"></div>
      </div>
    </div>
    <div class="outils">
      <h3 style="text-align: center;">‚úÖ Outils pour le d√©veloppement üöÄ</h3>
      <div class="App-list">
        <a href="/termux" class="dw-app" data-target="termux">
          <img src="img/termux.png">
          <span class="title">Termux</span>
        </a>
        <a href="/kswebserver" class="dw-app" data-target="kswebserver">
          <img src="img/kswebserver.png">
          <span class="title">KS Web Server</span>
        </a>
        <a href="/trebEdit" class="dw-app" data-target="trebEdit">
          <img src="img/trebEdit.png">
          <span class="title">TrebEdit</span>
        </a>
      </div>
    </div>
  <div id="tutorial-container"></div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.28.0/prism.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
  const container = document.getElementById("tutorial-container");
  const titleElement = document.getElementById("page-title");
  const spinner = document.querySelector(".skeleton-container");
  const outils = document.querySelector(".outils");
  const links = document.querySelectorAll(".dw-app");

  const defaultContent = {
    title: "Tutoriel React, Redux & Vite",
    jsonFile: "tuto.json",
  };

  const routes = {
    termux: {
      title: "Tuto Termux",
      jsonFile: "tuto-termux.json",
    },
    kswebserver: {
      title: "Tuto KS Web Server",
      jsonFile: "tuto-kswebserver.json",
    },
    trebEdit: {
      title: "Tuto TrebEdit",
      jsonFile: "tuto-trebedit.json",
    },
  };

  const loadContent = async (route) => {
    const routeData = routes[route] || defaultContent;
    titleElement.textContent = routeData.title;
    spinner.style.display = "block";
    container.innerHTML = ""; // Nettoyage du contenu pr√©c√©dent

    // Ajout d'un d√©lai minimum pour afficher le skeleton
    await new Promise((resolve) => setTimeout(resolve, 1300));

    try {
      const response = await fetch(routeData.jsonFile);
      const sections = await response.json();

      sections.forEach((section) => {
        const sectionElement = document.createElement("div");
        sectionElement.classList.add("section");

        let codeContent = "";

        if (section.codeBlocks.length > 1 && section.liste === true) {
          codeContent = `
            <ul>
              ${section.codeBlocks
                .map(
                  (block) => `
                    <li>
                      <strong>${block.label || "Code"}</strong>
                      <div class="code-block">
                        <pre><code class="language-${block.language}">${escapeHTML(block.code)}</code></pre>
                        <button class="copy-btn" onclick="copyCode(this)">Copier</button>
                      </div>
                    </li>
                  `
                )
                .join("")}
            </ul>
          `;
        } else {
          codeContent = section.codeBlocks
            .map(
              (block) => `
                <strong>${block.label || ""}</strong>
                <div class="code-block">
                  <pre><code class="language-${block.language}">${escapeHTML(block.code)}</code></pre>
                  <button class="copy-btn" onclick="copyCode(this)">Copier</button>
                </div>
              `
            )
            .join("");
        }

        sectionElement.innerHTML = `
          <h2>${section.title}</h2>
          <p>${section.description}</p>
          ${codeContent}
        `;
        container.appendChild(sectionElement);
      });

      Prism.highlightAll(); // Appliquer la coloration syntaxique
    } catch (error) {
      container.innerHTML = `<p>Erreur lors du chargement du contenu.</p>`;
      console.error(error);
    } finally {
      spinner.style.display = "none";
      outils.style.display = "block";
    }
  };

  const updateActiveClass = (route) => {
    links.forEach((link) => {
      link.classList.toggle("active", link.dataset.target === route);
    });
  };

  const handleNavigation = (route) => {
    history.pushState({}, "", `/${route}`);
    loadContent(route);
    updateActiveClass(route);
  };

  // G√©rer les clics sur les liens
  links.forEach((link) => {
    link.addEventListener("click", (event) => {
      event.preventDefault();
      const target = link.dataset.target;
      handleNavigation(target);
    });
  });

  // G√©rer les actualisations et URL incorrectes
  const currentRoute = window.location.pathname.slice(1) || "default";
  loadContent(currentRoute in routes ? currentRoute : "default");
  updateActiveClass(currentRoute);

  // Fonction pour copier le contenu du code
  function copyCode(button) {
    const codeElement = button.previousElementSibling;
    const textToCopy = codeElement.textContent || codeElement.innerText;

    const tempInput = document.createElement("textarea");
    document.body.appendChild(tempInput);
    tempInput.value = textToCopy;
    tempInput.select();
    document.execCommand("copy");
    document.body.removeChild(tempInput);

    button.textContent = "Copi√©!";
    setTimeout(() => (button.textContent = "Copier"), 1500);
  }

  // Fonction pour √©chapper les caract√®res sp√©ciaux dans le code
  function escapeHTML(str) {
    return str.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
  }
});

  </script>
</body>
</html>
